import{r as c,o as l,c as u,b as a,w as e,a as n,F as r,f as p,d as s}from"./app.ac87f1d0.js";import{_ as i}from"./plugin-vue_export-helper.21dcd24c.js";const k={},E=p(`<h1 id="\u7B2C-4-\u7AE0-\u54CD\u5E94\u7CFB\u7EDF\u7684\u4F5C\u7528\u4E0E\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u7B2C-4-\u7AE0-\u54CD\u5E94\u7CFB\u7EDF\u7684\u4F5C\u7528\u4E0E\u5B9E\u73B0" aria-hidden="true">#</a> \u7B2C 4 \u7AE0 \u54CD\u5E94\u7CFB\u7EDF\u7684\u4F5C\u7528\u4E0E\u5B9E\u73B0</h1><p>\u54CD\u5E94\u7CFB\u7EDF\u662F Vue.js \u7684\u91CD\u8981\u7EC4\u6210\u90E8\u5206\uFF0CVue.js 3 \u91C7\u7528 Proxy \u5B9E\u73B0\u54CD\u5E94\u5F0F\u6570\u636E\u3002</p><h2 id="_4-1-\u54CD\u5E94\u5F0F\u6570\u636E\u4E0E\u526F\u4F5C\u7528\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#_4-1-\u54CD\u5E94\u5F0F\u6570\u636E\u4E0E\u526F\u4F5C\u7528\u51FD\u6570" aria-hidden="true">#</a> 4.1 \u54CD\u5E94\u5F0F\u6570\u636E\u4E0E\u526F\u4F5C\u7528\u51FD\u6570</h2><p>\u526F\u4F5C\u7528\u51FD\u6570\u662F\u6307\u4F1A\u4EA7\u751F\u526F\u4F5C\u7528\u7684\u51FD\u6570\u3002\u526F\u4F5C\u7528\u51FD\u6570\u7684\u6267\u884C\u4F1A\u76F4\u63A5\u6216\u95F4\u63A5\u5F71\u54CD\u5176\u4ED6\u7684\u53D8\u91CF\u6216\u5176\u4ED6\u51FD\u6570\u7684\u6267\u884C\u3002</p><p>\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;hello world&#39;</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>text <span class="token operator">=</span> obj<span class="token punctuation">.</span>text
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> obj<span class="token punctuation">.</span>text
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>effect \u6267\u884C\u4F1A\u8BFB\u53D6 obj\uFF0C\u5E76\u8BBE\u7F6E state\uFF0C\u4EE5\u53CA\u66F4\u6539 DOM \u5143\u7D20\uFF0C\u8FD9\u4E2A\u5C31\u662F\u526F\u4F5C\u7528\u3002</p><p>\u4F46\u662F\uFF0Cobj.text \u6539\u4E86\u4E4B\u540E\uFF0C\u5E76\u4E0D\u4F1A\u81EA\u52A8\u6267\u884C effect \u51FD\u6570\u3002</p><h2 id="_4-2-\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u57FA\u672C\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_4-2-\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u57FA\u672C\u5B9E\u73B0" aria-hidden="true">#</a> 4.2 \u54CD\u5E94\u5F0F\u6570\u636E\u7684\u57FA\u672C\u5B9E\u73B0</h2><p>\u89C2\u5BDF\u53EF\u4EE5\u770B\u51FA\uFF1A</p><ul><li>\u526F\u4F5C\u7528\u51FD\u6570 effect \u6267\u884C\u65F6\uFF0C\u4F1A\u51FA\u53D1 obj.text \u7684<strong>\u8BFB\u53D6</strong>\u64CD\u4F5C</li><li>\u4FEE\u6539 obj.text \u65F6\uFF0C\u4F1A\u89E6\u53D1<strong>\u8BBE\u7F6E</strong>\u64CD\u4F5C</li></ul><p>\u5982\u679C\u6211\u4EEC\u80FD\u62E6\u622A\u4E00\u4E2A\u5BF9\u8C61\u7684\u8BFB\u53D6\u548C\u8BBE\u7F6E\u64CD\u4F5C\uFF0C\u90A3\u4E48\u5C31\u80FD\u505A\u4E00\u4E9B\u989D\u5916\u7684\u64CD\u4F5C\u3002</p><p>\u5728 ES2015 \u4E4B\u524D\u53EA\u80FD\u901A\u8FC7 Object.defineProperty \u51FD\u6570\u5B9E\u73B0\uFF0C\u8FD9\u4E5F\u662F Vue.js 2 \u6240\u91C7\u7528\u7684\u65B9\u5F0F\u3002\u5728 ES2015+ \u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4EE3\u7406\u5BF9\u8C61 Proxy \u6765\u5B9E\u73B0\uFF0C\u8FD9\u4E5F\u662F Vue.js 3 \u6240\u91C7\u7528\u7684\u65B9\u5F0F\u3002</p><div class="custom-container note"><p class="custom-container-title">Proxy \u793A\u4F8B</p><div id="effect-proxy-demo"></div></div>`,14),b=n("div",{class:"language-html ext-html line-numbers-mode"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("div")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("effect-proxy-demo"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("div")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("button")]),s(),n("span",{class:"token special-attr"},[n("span",{class:"token attr-name"},"onclick"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token value javascript language-javascript"},[n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),n("span",{class:"token punctuation"},'"')])]),n("span",{class:"token punctuation"},">")]),s("Change Text"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("button")]),n("span",{class:"token punctuation"},">")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br")])],-1),m=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// \u5B58\u50A8\u526F\u4F5C\u7528\u51FD\u6570\u7684\u6876"),s(`
`),n("span",{class:"token keyword"},"const"),s(" bucket "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u539F\u59CB\u6570\u636E"),s(`
`),n("span",{class:"token keyword"},"const"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"text"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'hello world'"),s(),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"// \u5BF9\u539F\u59CB\u6570\u636E\u7684\u4EE3\u7406"),s(`
`),n("span",{class:"token keyword"},"const"),s(" obj "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BFB\u53D6\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5C06\u526F\u4F5C\u7528\u51FD\u6570 effect \u6DFB\u52A0\u5230\u526F\u4F5C\u7528\u51FD\u6570\u6876\u4E2D"),s(`
    bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("effect"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE\u5C5E\u6027\u503C"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" target"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BBE\u7F6E\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u8BBE\u7F6E\u5C5E\u6027\u503C"),s(`
    target`),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(` newVal
    `),n("span",{class:"token comment"},"// \u628A\u526F\u4F5C\u7528\u51FD\u6570\u4ECE\u6876\u4E2D\u53D6\u51FA\u6765\u5E76\u6267\u884C"),s(`
    bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE true \u4EE3\u8868 \u8BBE\u7F6E\u6210\u529F"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"."),s("document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#effect-proxy-demo'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("innerText "),n("span",{class:"token operator"},"="),s(" obj"),n("span",{class:"token punctuation"},"."),s(`text
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u89E6\u53D1\u8BFB\u53D6"),s(`
`),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("text "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br")])],-1),f=p('<p>\u4E0A\u8FF0\u793A\u4F8B\uFF0C\u53EF\u4EE5\u8FBE\u5230\u54CD\u5E94\u5F0F\u7684\u7ED3\u679C\u3002</p><h2 id="_4-3-\u8BBE\u8BA1\u4E00\u4E2A\u5B8C\u5584\u7684\u54CD\u5E94\u5F0F\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#_4-3-\u8BBE\u8BA1\u4E00\u4E2A\u5B8C\u5584\u7684\u54CD\u5E94\u5F0F\u7CFB\u7EDF" aria-hidden="true">#</a> 4.3 \u8BBE\u8BA1\u4E00\u4E2A\u5B8C\u5584\u7684\u54CD\u5E94\u5F0F\u7CFB\u7EDF</h2><p>\u4ECE\u4E0A\u4E00\u8282\u4E2D\u770B\u51FA\uFF0C\u4E00\u4E2A\u54CD\u5E94\u5F0F\u7CFB\u7EDF\u7684\u5DE5\u4F5C\u6D41\u5982\u4E0B\uFF1A</p><ul><li>\u5F53<strong>\u8BFB\u53D6</strong>\u64CD\u4F5C\u53D1\u751F\u65F6\uFF0C\u5C06\u526F\u4F5C\u7528\u6536\u96C6\u5230\u6876\u4E2D</li><li>\u5F53<strong>\u8BBE\u7F6E</strong>\u64CD\u4F5C\u53D1\u751F\u65F6\uFF0C\u4ECE\u6876\u4E2D\u53D6\u51FA\u526F\u4F5C\u7528\u51FD\u6570\u5E76\u6267\u884C</li></ul><p>\u4E0A\u8282\u4E2D\u7684\u526F\u4F5C\u7528\u51FD\u6570 effect \u786C\u7F16\u7801\uFF0C\u4E0D\u5408\u9002\uFF0C\u6211\u4EEC\u8981\u505A\u7684\u662F\uFF0C\u54EA\u6015\u526F\u4F5C\u7528\u662F\u533F\u540D\u51FD\u6570\u4E5F\u80FD\u591F\u88AB\u6B63\u786E\u7684\u6536\u96C6\u3002 \u4E3A\u4E86\u5B9E\u73B0\u8FD9\u4E00\u70B9\uFF0C\u6211\u4EEC\u9700\u8981\u63D0\u4F9B\u4E00\u4E2A\u7528\u6765\u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570\u7684\u673A\u5236\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="custom-container note"><p class="custom-container-title">\u6539\u8FDB\u540E\u7684\u793A\u4F8B</p><div id="effect-proxy-demo2"></div></div>',6),B=n("div",{class:"language-html ext-html line-numbers-mode"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("div")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("effect-proxy-demo2"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("div")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("button")]),s(),n("span",{class:"token special-attr"},[n("span",{class:"token attr-name"},"onclick"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token value javascript language-javascript"},[n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),n("span",{class:"token punctuation"},'"')])]),n("span",{class:"token punctuation"},">")]),s("Change Text"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("button")]),n("span",{class:"token punctuation"},">")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br")])],-1),d=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// \u7528\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\u5B58\u50A8\u88AB\u6CE8\u518C\u7684\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token keyword"},"let"),s(` activeEffect

`),n("span",{class:"token comment"},"// effect \u51FD\u6570\u7528\u4E8E\u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u5F53\u8C03\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u5C06\u526F\u4F5C\u7528\u51FD\u6570 fn \u8D4B\u503C\u7ED9 activeEffect"),s(`
  activeEffect `),n("span",{class:"token operator"},"="),s(` fn
  `),n("span",{class:"token comment"},"// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  `),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u5B58\u50A8\u526F\u4F5C\u7528\u51FD\u6570\u7684\u6876"),s(`
`),n("span",{class:"token keyword"},"const"),s(" bucket "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u539F\u59CB\u6570\u636E"),s(`
`),n("span",{class:"token keyword"},"const"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"text"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'hello world'"),s(),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"// \u5BF9\u539F\u59CB\u6570\u636E\u7684\u4EE3\u7406"),s(`
`),n("span",{class:"token keyword"},"const"),s(" obj "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BFB\u53D6\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5C06 activeEffect \u4E2D\u5B58\u50A8\u7684\u526F\u4F5C\u7528\u51FD\u6570\u6536\u96C6\u5230\u6876\u4E2D"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token comment"},"// \u65B0\u589E"),s(`
      bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE\u5C5E\u6027\u503C"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" target"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BBE\u7F6E\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u8BBE\u7F6E\u5C5E\u6027\u503C"),s(`
    target`),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(` newVal
    `),n("span",{class:"token comment"},"// \u628A\u526F\u4F5C\u7528\u51FD\u6570\u4ECE\u6876\u4E2D\u53D6\u51FA\u6765\u5E76\u6267\u884C"),s(`
    bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE true \u4EE3\u8868 \u8BBE\u7F6E\u6210\u529F"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u4F7F\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u533F\u540D\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'effect run'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// \u4F1A\u6253\u5370 2 \u6B21\uFF0C\u6CE8\u518C\u65F6\u7ACB\u5373\u6267\u884C\u4E86\u4E00\u6B21\uFF0C\u540E\u9762\u66F4\u6539 obj.notExist \u65F6\u4F1A\u518D\u6267\u884C\u4E00\u6B21"),s(`
  window`),n("span",{class:"token punctuation"},"."),s("document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#effect-proxy-demo2'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("innerText "),n("span",{class:"token operator"},"="),s(" obj"),n("span",{class:"token punctuation"},"."),s(`text
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("notExist "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br")])],-1),C=n("p",null,"\u4E0A\u9762\u4EE3\u7801\u53EF\u4EE5\u770B\u51FA\uFF0C\u533F\u540D\u526F\u4F5C\u7528\u51FD\u6570\u5185\u90E8\u8BFB\u53D6\u4E86 obj.text \u7684\u503C\uFF0C\u4E8E\u662F\u533F\u540D\u51FD\u6570\u4E0E\u5B57\u6BB5 obj.text \u4E4B\u95F4\u5EFA\u7ACB\u4E86\u54CD\u5E94\u8054\u7CFB\u3002 \u4F46\u662F\uFF0C\u70B9\u51FB change text \u65F6\uFF0C\u5728\u533F\u540D\u526F\u4F5C\u7528\u5185\u5E76\u6CA1\u6709\u8BFB\u53D6 obj.notExist \u5C5E\u6027\u7684\u503C\uFF0C\u6240\u4EE5\uFF0C\u7406\u8BBA\u4E0A\u5B57\u6BB5 obj.notExist \u5E76\u6CA1\u6709\u4E0E\u526F\u4F5C\u7528\u5EFA\u7ACB\u54CD\u5E94\u8054\u7CFB\u3002 \u56E0\u6B64\uFF0C\u70B9\u51FB\u6309\u94AE\u65F6\uFF0C\u4E0D\u5E94\u8BE5\u51FA\u53D1\u533F\u540D\u526F\u4F5C\u7528\uFF0C\u8FD9\u662F\u4E0D\u6B63\u786E\u7684\uFF0C\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u5E94\u8BE5\u91CD\u65B0\u8BBE\u8BA1\u6876\u3002",-1),A=n("p",null,[s("\u5728\u4E0A\u4F8B\u4E2D\uFF0C\u6211\u4EEC"),n("strong",null,"\u6CA1\u6709\u5728\u526F\u4F5C\u7528\u51FD\u6570\u4E0E\u88AB\u64CD\u4F5C\u7684\u76EE\u6807\u5B57\u6BB5\u4E4B\u95F4\u5EFA\u7ACB\u660E\u786E\u7684\u8054\u7CFB"),s("\u3002\u5F53\u8BFB\u53D6\u5C5E\u6027\u65F6\uFF0C\u65E0\u8BBA\u8BFB\u53D6\u7684\u662F\u54EA\u4E00\u4E2A\u5C5E\u6027\uFF0C\u90FD\u4F1A\u628A\u526F\u4F5C\u7528\u51FD\u6570\u6536\u96C6\u5230\u6876\u4E2D\uFF1B \u5F53\u8BBE\u7F6E\u5C5E\u6027\u65F6\uFF0C\u4E5F\u90FD\u4F1A\u628A\u6876\u4E2D\u7684\u526F\u4F5C\u7528\u51FD\u6570\u53D6\u51FA\u6765\u5E76\u6267\u884C\u3002\u89E3\u51B3\u529E\u6CD5\u53EA\u9700\u8981\u5728\u526F\u4F5C\u7528\u4E0E\u88AB\u64CD\u4F5C\u7684\u5B57\u6BB5\u76F4\u63A5\u5EFA\u7ACB\u8054\u7CFB\u3002")],-1),F=n("p",null,"Set \u7C7B\u578B\u7684\u6876\uFF0C\u4E0D\u80FD\u5B9E\u73B0\u8FD9\u4E2A\u76EE\u7684\uFF0C\u9700\u8981\u4F7F\u7528 WeakMap \u4EE3\u66FF Set \u4F5C\u4E3A\u6876\u7684\u6570\u636E\u7ED3\u6784\u3002",-1),g=n("div",{class:"custom-container note"},[n("p",{class:"custom-container-title"},"WeakMap \u7C7B\u578B\u7684\u6876"),n("div",{id:"effect-proxy-weakmap"})],-1),D=n("div",{class:"language-html ext-html line-numbers-mode"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("div")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("effect-proxy-weakmap"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("div")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("button")]),s(),n("span",{class:"token special-attr"},[n("span",{class:"token attr-name"},"onclick"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token value javascript language-javascript"},[n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),n("span",{class:"token punctuation"},'"')])]),n("span",{class:"token punctuation"},">")]),s("Change Text"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("button")]),n("span",{class:"token punctuation"},">")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br")])],-1),y=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// \u5143\u7D20\u6570\u636E"),s(`
`),n("span",{class:"token keyword"},"const"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"ok"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"text"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'hello world'"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u5B58\u50A8\u526F\u4F5C\u7528\u7684\u6876"),s(`
`),n("span",{class:"token keyword"},"const"),s(" bucket "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"WeakMap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"let"),s(` activeEffect

`),n("span",{class:"token keyword"},"const"),s(" obj "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BFB\u53D6\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5C06\u526F\u4F5C\u7528\u51FD\u6570 \u6DFB\u52A0\u5230\u6876\u4E2D"),s(`
    `),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE\u5C5E\u6027\u503C"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" target"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BBE\u7F6E\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u8BBE\u7F6E\u5C5E\u6027\u503C"),s(`
    target`),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(` newVal
    `),n("span",{class:"token comment"},"// \u628A\u526F\u4F5C\u7528\u51FD\u6570\u4ECE\u6876\u4E2D\u53D6\u51FA\u5E76\u6267\u884C"),s(`
    `),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u5728 get \u62E6\u622A\u51FD\u6570\u5185\u8C03\u7528 track \u51FD\u6570\u8FFD\u8E2A\u53D8\u5316"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("target"),n("span",{class:"token punctuation"},","),s(" key")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u6CA1\u6709 activeEffect \u76F4\u63A5\u8FD4\u56DE"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`
  `),n("span",{class:"token comment"},"// \u6839\u636E target \u4ECE\u6876\u4E2D\u53D6\u5F97 depsMap\uFF0C\u5B83\u4E5F\u662F\u4E00\u4E2A Map \u7C7B\u578B\uFF0Ckey: effects"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" bucket"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u4E0D\u5B58\u5728 depsMap\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A Map \u4E0E target \u5173\u8054"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("depsMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u518D\u6839\u636E key \u4ECE depsMap \u4E2D\u53D6\u5F97 deps\uFF0C\u5B83\u662F\u4E00\u4E2A Set \u7C7B\u578B"),s(`
  `),n("span",{class:"token comment"},"// \u91CC\u9762\u5B58\u50A8\u7740\u6240\u6709\u4E0E\u5F53\u524D key \u5173\u8054\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF1Aeffects"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" deps "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C deps \u4E0D\u5B58\u5728\uFF0C\u5219\u540C\u6837\u65B0\u5EFA\u4E00\u4E2A Set \u4E0E key \u5173\u8054"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("deps"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    depsMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("deps "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u6700\u540E\u5C06\u5F53\u524D\u6FC0\u6D3B\u7684\u526F\u4F5C\u7528\u6DFB\u52A0\u5230\u6876\u4E2D"),s(`
  deps`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u5728 set \u62E6\u622A\u51FD\u6570\u5185\u8C03\u7528 trigger \u51FD\u6570\u51FA\u53D1\u53D8\u5316"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("target"),n("span",{class:"token punctuation"},","),s(" key")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u6839\u636E target \u4ECE\u6876\u4E2D\u53D6\u5F97 depsMap\uFF0C\u5B83\u662F key: effects"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" bucket"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`
  `),n("span",{class:"token comment"},"// \u6839\u636E key \u53D6\u5F97\u6240\u6709\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" effects "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  effects `),n("span",{class:"token operator"},"&&"),s(" effects"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// effect \u51FD\u6570\u7528\u4E8E\u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u5F53\u8C03\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u5C06\u526F\u4F5C\u7528\u51FD\u6570 fn \u8D4B\u503C\u7ED9 activeEffect"),s(`
  activeEffect `),n("span",{class:"token operator"},"="),s(` fn
  `),n("span",{class:"token comment"},"// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  `),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u4F7F\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u533F\u540D\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'effect run - weekmap'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// \u4F1A\u6253\u5370 2 \u6B21\uFF0C\u6CE8\u518C\u65F6\u7ACB\u5373\u6267\u884C\u4E86\u4E00\u6B21\uFF0C\u540E\u9762\u66F4\u6539 obj.text \u65F6\u4F1A\u518D\u6267\u884C\u4E00\u6B21\uFF0Cobj.notExist \u4E0D\u6267\u884C"),s(`
  window`),n("span",{class:"token punctuation"},"."),s("document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#effect-proxy-weakmap'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("innerText "),n("span",{class:"token operator"},"="),s(" obj"),n("span",{class:"token punctuation"},"."),s(`text
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("text "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("notExist "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br")])],-1),w=n("p",null,"\u4ECE\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u51FA\u6784\u5EFA\u6570\u636E\u7684\u65B9\u5F0F\uFF0C\u5206\u522B\u4F7F\u7528\u4E86 WeakMap, Map \u548C Set:",-1),v=n("ul",null,[n("li",null,"WeakMap \u662F target: Map \u952E\u503C\u5BF9"),n("li",null,"Map \u662F target.key: effects \uFF08\u526F\u4F5C\u7528\uFF09 \u952E\u503C\u5BF9")],-1),h=n("p",null,"\u90A3\u4E48\uFF0CWeakMap \u8DDF Map \u6709\u4EC0\u4E48\u533A\u522B\u5462\uFF1F",-1),x=s("WeakMap \u5BF9 key \u662F\u5F31\u5F15\u7528\uFF0CWeakMap \u7684 key \u662F\u4E0D\u53EF\u679A\u4E3E\u7684\uFF0C\u4E0D\u5F71\u54CD\u5783\u573E\u56DE\u6536\u5668\u7684\u5DE5\u4F5C\u3002 \u53C2\u8003\u8D44\u6599\uFF1A"),j={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap",target:"_blank",rel:"noopener noreferrer"},M=s("MDN"),_=n("p",null,"\u8BF7\u6253\u5F00\u63A7\u5236\u53F0\u67E5\u770B\uFF1A",-1),S=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" map "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"const"),s(" weakmap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"WeakMap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" foo "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"foo"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" bar "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"bar"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token punctuation"},"}"),s(`

  map`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("foo"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
  weakmap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("bar"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u53EF\u4EE5\u6253\u5370\u51FA foo\uFF0C\u8BF4\u660E foo \u6CA1\u6709\u88AB\u56DE\u6536"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'map.keys'"),n("span",{class:"token punctuation"},","),s(" map"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token comment"},"// WeakMap \u65E0\u6CD5\u83B7\u53D6 key\uFF0C\u4E5F\u5C31\u65E0\u6CD5\u83B7\u53D6\u5BF9\u8C61 bar"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'weakmap'"),n("span",{class:"token punctuation"},","),s(" weakmap"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br")])],-1),T=p(`<h2 id="_4-4-\u5206\u652F\u5207\u6362\u4E0E-cleanup" tabindex="-1"><a class="header-anchor" href="#_4-4-\u5206\u652F\u5207\u6362\u4E0E-cleanup" aria-hidden="true">#</a> 4.4 \u5206\u652F\u5207\u6362\u4E0E cleanup</h2><p>\u4EC0\u4E48\u662F\u5206\u652F\u5B9A\u4E49\uFF1F\u5148\u770B\u4E0B\u9762\u7684\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ok</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;hello world&#39;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> obj<span class="token punctuation">.</span>ok <span class="token operator">?</span> obj<span class="token punctuation">.</span>text <span class="token operator">:</span> <span class="token string">&#39;not&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4E0A\u9762\u7684\u4E09\u5143\u8868\u8FBE\u5F0F\u4E2D\uFF0C\u5F53\u5B57\u6BB5 obj.ok \u53D1\u9001\u53D8\u5316\u65F6\uFF0C\u4EE3\u7801\u6267\u884C\u7684\u5206\u652F\u5C31\u4F1A\u8DDF\u7740\u53D8\u5316\uFF0C\u8FD9\u5C31\u662F\u5206\u652F\u5207\u6362\u3002</p><p>\u5206\u652F\u5207\u6362\u53EF\u80FD\u4F1A\u4EA7\u751F\u9057\u7559\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002\u4E0A\u9762\u7684\u4EE3\u7801\u4E2D\uFF0C\u4F1A\u89E6\u53D1 obj.ok \u548C obj.text \u7684\u8BFB\u53D6\u64CD\u4F5C\uFF0C\u6240\u4EE5\u4F1A\u6536\u96C6\u5B83\u4EEC\u4FE9\u5BF9\u5E94\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002</p><p>\u5F53 obj.ok \u4FEE\u6539\u4E3A false \u65F6\uFF0C\u4F1A\u89E6\u53D1\u526F\u4F5C\u7528\u51FD\u6570\u91CD\u65B0\u6267\u884C\u540E\uFF0C\u7531\u4E8E\u6B64\u65F6\u5B57\u6BB5 obj.text \u4E0D\u4F1A\u88AB\u8BFB\u53D6\uFF0C\u53EA\u4F1A\u6267\u884C obj.ok \u7684\u8BFB\u53D6\u64CD\u4F5C\u3002 \u6240\u4EE5\uFF0C\u7406\u60F3\u60C5\u51B5\u4E0B\uFF0C\u526F\u4F5C\u7528\u51FD\u6570\u4E0D\u5E94\u8BE5\u88AB\u5B57\u6BB5 obj.text \u6240\u5BF9\u5E94\u7684\u4F9D\u8D56\u96C6\u5408\u6536\u96C6\u3002</p><p>\u9057\u7559\u7684\u526F\u4F5C\u7528\u4F1A\u5BFC\u81F4\u4E0D\u5FC5\u8981\u7684\u66F4\u65B0\u3002</p><p>\u4F46\u662F\u4E0A\u4F8B\u4E2D\uFF0Cobj.ok \u6539\u4E3A false \u65F6\uFF0C\u65E0\u8BBA obj.text \u5982\u4F55\u53D8\uFF0Cdocument.body.innerText \u7684\u503C\u59CB\u7EC8\u662F &#39;not&#39; \u3002 \u6240\u4EE5\uFF0C\u6700\u597D\u7684\u7ED3\u679C\u662F\uFF0C\u65E0\u8BBA obj.text \u5982\u4F55\u53D8\uFF0C\u90FD\u4E0D\u9700\u8981\u91CD\u65B0\u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570\u3002</p><p>\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u7684\u601D\u8DEF\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u6BCF\u6B21\u526F\u4F5C\u7528\u6267\u884C\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5148\u628A\u5B83\u4ECE\u6240\u6709\u4E0E\u4E4B\u5173\u8054\u7684\u4F9D\u8D56\u96C6\u5408\u4E2D\u5220\u9664\u3002</p><p>\u5F53\u526F\u4F5C\u7528\u51FD\u6570\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u4F1A\u91CD\u65B0\u5EFA\u7ACB\u8054\u7CFB\uFF0C\u4F46\u5728\u65B0\u7684\u8054\u7CFB\u4E2D\u4E0D\u4F1A\u5305\u542B\u9057\u7559\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002</p><p>\u8981\u5C06\u4E00\u4E2A\u526F\u4F5C\u7528\u51FD\u6570\u4ECE\u6240\u6709\u4E0E\u4E4B\u5173\u8054\u7684\u4F9D\u8D56\u96C6\u5408\u4E2D\u79FB\u9664\uFF0C\u9700\u8981\u660E\u786E\u6709\u54EA\u4E9B\u4F9D\u8D56\u96C6\u5408\u4E2D\u5305\u542B\u5B83\uFF0C\u56E0\u6B64\uFF0C\u6211\u4EEC\u8981\u91CD\u65B0\u8BBE\u8BA1\u526F\u4F5C\u7528\u51FD\u6570\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u7528\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\u5B58\u50A8\u88AB\u6CE8\u518C\u7684\u526F\u4F5C\u7528\u51FD\u6570</span>
<span class="token keyword">let</span> activeEffect
<span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">effectFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8C03\u7528 cleanup \u51FD\u6570\u5B8C\u6210\u6E05\u9664\u5DE5\u4F5C</span>
    <span class="token function">cleanup</span><span class="token punctuation">(</span>effectFn<span class="token punctuation">)</span>
    <span class="token comment">// \u5F53 effectFn \u6267\u884C\u65F6\uFF0C\u5C06\u5176\u8BBE\u4E3A\u5F53\u524D\u6FC0\u6D3B\u7684\u526F\u4F5C\u7528\u51FD\u6570</span>
    activeEffect <span class="token operator">=</span> effectFn
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// effectFn.deps \u7528\u6765\u5B58\u50A8\u6240\u6709\u4E0E\u8BE5\u526F\u4F5C\u7528\u51FD\u6570\u76F8\u5173\u8054\u7684\u4F9D\u8D56\u96C6\u5408</span>
  effectFn<span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570</span>
  <span class="token function">effectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u6CA1\u6709 activeEffect \u76F4\u63A5\u8FD4\u56DE</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activeEffect<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token comment">// \u6839\u636E target \u4ECE\u6876\u4E2D\u53D6\u5F97 depsMap\uFF0C\u5B83\u4E5F\u662F\u4E00\u4E2A Map \u7C7B\u578B\uFF0Ckey: effects</span>
  <span class="token keyword">let</span> depsMap <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token comment">// \u5982\u679C\u4E0D\u5B58\u5728 depsMap\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A Map \u4E0E target \u5173\u8054</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bucket<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">(</span>depsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u518D\u6839\u636E key \u4ECE depsMap \u4E2D\u53D6\u5F97 deps\uFF0C\u5B83\u662F\u4E00\u4E2A Set \u7C7B\u578B</span>
  <span class="token comment">// \u91CC\u9762\u5B58\u50A8\u7740\u6240\u6709\u4E0E\u5F53\u524D key \u5173\u8054\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF1Aeffects</span>
  <span class="token keyword">let</span> deps <span class="token operator">=</span> depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token comment">// \u5982\u679C deps \u4E0D\u5B58\u5728\uFF0C\u5219\u540C\u6837\u65B0\u5EFA\u4E00\u4E2A Set \u4E0E key \u5173\u8054</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    depsMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>deps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u628A\u5F53\u524D\u6FC0\u6D3B\u7684\u526F\u4F5C\u7528\u51FD\u6570\u6DFB\u52A0\u5230\u4F9D\u8D56\u96C6\u5408 deps \u4E2D</span>
  deps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span>
  <span class="token comment">// deps \u5C31\u662F\u4E00\u4E2A\u4E0E\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u5B58\u5728\u8054\u7CFB\u7684\u4F9D\u8D56\u96C6\u5408</span>
  <span class="token comment">// \u5C06\u5176\u6DFB\u52A0\u5230 activeEffect.deps \u6570\u7EC4\u4E2D</span>
  activeEffect<span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token parameter">effectFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u904D\u5386 effectFn \u7684 deps \u6570\u7EC4</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> effectFn<span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// deps \u662F\u4F9D\u8D56\u96C6\u5408</span>
    <span class="token keyword">const</span> deps <span class="token operator">=</span> effectFn<span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment">// \u5C06 effectFn \u4ECE\u4F9D\u8D56\u96C6\u5408\u4E2D\u79FB\u9664</span>
    deps<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>effectFn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u6700\u540E\u9700\u8981\u91CD\u7F6E effectFn.deps \u6570\u7EC4</span>
  effectFn<span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> depsMap <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> effects <span class="token operator">=</span> depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token comment">// effects &amp;&amp; effects.forEach(fn =&gt; fn()) // \u5220\u9664\uFF0C\u8FD9\u4E2A\u4F1A\u5BFC\u81F4\u6B7B\u5FAA\u73AF</span>

  <span class="token comment">// \u6784\u9020\u4E00\u4E2A\u65B0\u7684\u96C6\u5408 effectToRun \u7136\u540E\u53D8\u91CF\u5B83\uFF0C\u7528\u6765\u904D\u5386\u5220\u9664\uFF0C\u907F\u514D\u6B7B\u5FAA\u73AF</span>
  <span class="token keyword">const</span> effectToRun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>effects<span class="token punctuation">)</span>
  effectToRun<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effectFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">effectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>\u5728 trigger \u4E2D\u6211\u4EEC\u904D\u5386 effects \u96C6\u5408\uFF0C\u5B83\u662F\u4E00\u4E2A Set \u96C6\u5408\uFF0C\u5F53\u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u4F1A\u8C03\u7528 cleanup \u8FDB\u884C\u6E05\u9664\uFF0C\u5B9E\u9645\u4E0A\u662F\u4ECE effects \u4E2D\u5C06\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u5254\u9664\u3002 \u4F46\u662F\u526F\u4F5C\u7528\u51FD\u6570\u7684\u6267\u884C\u4F1A\u5BFC\u81F4\u5176\u91CD\u65B0\u88AB\u6536\u96C6\uFF0C\u6B64\u65F6\u5BF9\u4E8E effects \u7684\u904D\u5386\u4ECD\u5728\u8FDB\u884C\uFF0C\u4F1A\u5F15\u8D77\u6B7B\u5FAA\u73AF\u3002</p><p>\u526A\u77ED\u7684\u4EE3\u7801\u6765\u8868\u8FBE\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u904D\u5386\u4E2D&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u8BED\u8A00\u89C4\u8303\u4E2D\u5BF9\u6B64\u6709\u660E\u786E\u7684\u8BF4\u660E\uFF1A\u5728\u8C03\u7528 forEach \u904D\u5386 Set \u96C6\u5408\u65F6\uFF0C\u5982\u679C\u4E00\u4E2A\u503C\u5DF2\u7ECF\u88AB\u8BBF\u95EE\u8FC7\u4E86\uFF0C\u4F46\u8BE5\u503C\u88AB\u5220\u9664\u5E76\u91CD\u65B0\u6DFB\u52A0\u5230\u96C6\u5408\uFF0C \u5982\u679C\u6B64\u65F6 forEach \u904D\u5386\u6CA1\u6709\u7ED3\u675F\uFF0C\u90A3\u4E48\u8BE5\u503C\u4F1A\u91CD\u65B0\u88AB\u8BBF\u95EE\u3002</p><p>\u56E0\u6B64\uFF0C\u4E0A\u9762\u7684\u4EE3\u7801\u4F1A\u65E0\u9650\u5FAA\u73AF\u3002\u89E3\u51B3\u529E\u6CD5\u4E5F\u5F88\u7B80\u5355\uFF0C\u6784\u9020\u9886\u4E00\u4E2A Set \u96C6\u5408\u5E76\u904D\u5386\u5B83\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> newSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span>
newSet<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u904D\u5386\u4E2D&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-container note"><p class="custom-container-title">\u5206\u652F\u5207\u6362\u4E0E cleanup demo \u8FD0\u884C\u7ED3\u679C</p><div id="effect-branch-cleanup"></div></div>`,19),V=n("div",{class:"language-html ext-html line-numbers-mode"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("div")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("effect-branch-cleanup"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("div")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("button")]),s(),n("span",{class:"token special-attr"},[n("span",{class:"token attr-name"},"onclick"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token value javascript language-javascript"},[n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),n("span",{class:"token punctuation"},'"')])]),n("span",{class:"token punctuation"},">")]),s("Change Text"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("button")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("input")]),s(`
  `),n("span",{class:"token attr-name"},"type"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("checkbox"),n("span",{class:"token punctuation"},'"')]),s(`
  `),n("span",{class:"token attr-name"},"checked"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("obj.ok"),n("span",{class:"token punctuation"},'"')]),s(`
  `),n("span",{class:"token special-attr"},[n("span",{class:"token attr-name"},"onclick"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),n("span",{class:"token value javascript language-javascript"},[n("span",{class:"token function"},"changeOk"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("checked"),n("span",{class:"token punctuation"},")")]),n("span",{class:"token punctuation"},'"')])]),s(`
`),n("span",{class:"token punctuation"},"/>")]),s(`Change OK
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br")])],-1),q=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// \u5B58\u50A8\u526F\u4F5C\u7528\u7684\u6876"),s(`
`),n("span",{class:"token keyword"},"const"),s(" bucket "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"WeakMap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token comment"},"// \u7528\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\u5B58\u50A8\u88AB\u6CE8\u518C\u7684\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token keyword"},"let"),s(` activeEffect

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"effectFn"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u8C03\u7528 cleanup \u51FD\u6570\u5B8C\u6210\u6E05\u9664\u5DE5\u4F5C"),s(`
    `),n("span",{class:"token function"},"cleanup"),n("span",{class:"token punctuation"},"("),s("effectFn"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u5F53 effectFn \u6267\u884C\u65F6\uFF0C\u5C06\u5176\u8BBE\u4E3A\u5F53\u524D\u6FC0\u6D3B\u7684\u526F\u4F5C\u7528\u51FD\u6570"),s(`
    activeEffect `),n("span",{class:"token operator"},"="),s(` effectFn
    `),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// effectFn.deps \u7528\u6765\u5B58\u50A8\u6240\u6709\u4E0E\u8BE5\u526F\u4F5C\u7528\u51FD\u6570\u76F8\u5173\u8054\u7684\u4F9D\u8D56\u96C6\u5408"),s(`
  effectFn`),n("span",{class:"token punctuation"},"."),s("deps "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token comment"},"// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  `),n("span",{class:"token function"},"effectFn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("target"),n("span",{class:"token punctuation"},","),s(" key")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u6CA1\u6709 activeEffect \u76F4\u63A5\u8FD4\u56DE"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`
  `),n("span",{class:"token comment"},"// \u6839\u636E target \u4ECE\u6876\u4E2D\u53D6\u5F97 depsMap\uFF0C\u5B83\u4E5F\u662F\u4E00\u4E2A Map \u7C7B\u578B\uFF0Ckey: effects"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" bucket"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u4E0D\u5B58\u5728 depsMap\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A Map \u4E0E target \u5173\u8054"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    bucket`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("depsMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u518D\u6839\u636E key \u4ECE depsMap \u4E2D\u53D6\u5F97 deps\uFF0C\u5B83\u662F\u4E00\u4E2A Set \u7C7B\u578B"),s(`
  `),n("span",{class:"token comment"},"// \u91CC\u9762\u5B58\u50A8\u7740\u6240\u6709\u4E0E\u5F53\u524D key \u5173\u8054\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF1Aeffects"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" deps "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C deps \u4E0D\u5B58\u5728\uFF0C\u5219\u540C\u6837\u65B0\u5EFA\u4E00\u4E2A Set \u4E0E key \u5173\u8054"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("deps"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    depsMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("deps "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u628A\u5F53\u524D\u6FC0\u6D3B\u7684\u526F\u4F5C\u7528\u51FD\u6570\u6DFB\u52A0\u5230\u4F9D\u8D56\u96C6\u5408 deps \u4E2D"),s(`
  deps`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// deps \u5C31\u662F\u4E00\u4E2A\u4E0E\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u5B58\u5728\u8054\u7CFB\u7684\u4F9D\u8D56\u96C6\u5408"),s(`
  `),n("span",{class:"token comment"},"// \u5C06\u5176\u6DFB\u52A0\u5230 activeEffect.deps \u6570\u7EC4\u4E2D"),s(`
  activeEffect`),n("span",{class:"token punctuation"},"."),s("deps"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("deps"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"cleanup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"effectFn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u904D\u5386 effectFn \u7684 deps \u6570\u7EC4"),s(`
  `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"let"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(" effectFn"),n("span",{class:"token punctuation"},"."),s("deps"),n("span",{class:"token punctuation"},"."),s("length"),n("span",{class:"token punctuation"},";"),s(" i"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// deps \u662F\u4F9D\u8D56\u96C6\u5408"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" deps "),n("span",{class:"token operator"},"="),s(" effectFn"),n("span",{class:"token punctuation"},"."),s("deps"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),s(`
    `),n("span",{class:"token comment"},"// \u5C06 effectFn \u4ECE\u4F9D\u8D56\u96C6\u5408\u4E2D\u79FB\u9664"),s(`
    deps`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),s("effectFn"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u6700\u540E\u9700\u8981\u91CD\u7F6E effectFn.deps \u6570\u7EC4"),s(`
  effectFn`),n("span",{class:"token punctuation"},"."),s("deps"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("target"),n("span",{class:"token punctuation"},","),s(" key")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" bucket"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" effects "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// effects && effects.forEach(fn => fn()) // \u5220\u9664\uFF0C\u8FD9\u4E2A\u4F1A\u5BFC\u81F4\u6B7B\u5FAA\u73AF"),s(`

  `),n("span",{class:"token comment"},"// \u6784\u9020\u4E00\u4E2A\u65B0\u7684\u96C6\u5408 effectToRun \u7136\u540E\u53D8\u91CF\u5B83\uFF0C\u7528\u6765\u904D\u5386\u5220\u9664\uFF0C\u907F\u514D\u6B7B\u5FAA\u73AF"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" effectToRun "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),s("effects"),n("span",{class:"token punctuation"},")"),s(`
  effectToRun`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"effectFn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"effectFn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// \u5143\u7D20\u6570\u636E"),s(`
`),n("span",{class:"token keyword"},"const"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"ok"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"text"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'hello world'"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"const"),s(" obj "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BFB\u53D6\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5C06\u526F\u4F5C\u7528\u51FD\u6570 \u6DFB\u52A0\u5230\u6876\u4E2D"),s(`
    `),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u8FD4\u56DE\u5C5E\u6027\u503C"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" target"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// \u62E6\u622A\u8BBE\u7F6E\u64CD\u4F5C"),s(`
  `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u8BBE\u7F6E\u5C5E\u6027\u503C"),s(`
    target`),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(` newVal
    `),n("span",{class:"token comment"},"// \u628A\u526F\u4F5C\u7528\u51FD\u6570\u4ECE\u6876\u4E2D\u53D6\u51FA\u5E76\u6267\u884C"),s(`
    `),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"// \u4F7F\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570"),s(`
`),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u533F\u540D\u526F\u4F5C\u7528\u51FD\u6570"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'effect run - branch-cleanup'"),n("span",{class:"token punctuation"},")"),s(`
  window`),n("span",{class:"token punctuation"},"."),s("document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#effect-branch-cleanup'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("innerText "),n("span",{class:"token operator"},"="),s(" obj"),n("span",{class:"token punctuation"},"."),s(`ok
    `),n("span",{class:"token operator"},"?"),s(" obj"),n("span",{class:"token punctuation"},"."),s(`text
    `),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'not'"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"changeText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("text "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("notExist "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'hello vue3'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"changeOk"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"val"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  obj`),n("span",{class:"token punctuation"},"."),s("ok "),n("span",{class:"token operator"},"="),s(` val
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br"),n("span",{class:"line-number"},"88"),n("br"),n("span",{class:"line-number"},"89"),n("br"),n("span",{class:"line-number"},"90"),n("br"),n("span",{class:"line-number"},"91"),n("br"),n("span",{class:"line-number"},"92"),n("br"),n("span",{class:"line-number"},"93"),n("br"),n("span",{class:"line-number"},"94"),n("br"),n("span",{class:"line-number"},"95"),n("br"),n("span",{class:"line-number"},"96"),n("br"),n("span",{class:"line-number"},"97"),n("br"),n("span",{class:"line-number"},"98"),n("br"),n("span",{class:"line-number"},"99"),n("br"),n("span",{class:"line-number"},"100"),n("br"),n("span",{class:"line-number"},"101"),n("br"),n("span",{class:"line-number"},"102"),n("br"),n("span",{class:"line-number"},"103"),n("br"),n("span",{class:"line-number"},"104"),n("br"),n("span",{class:"line-number"},"105"),n("br"),n("span",{class:"line-number"},"106"),n("br"),n("span",{class:"line-number"},"107"),n("br"),n("span",{class:"line-number"},"108"),n("br")])],-1),W=p(`<h2 id="_4-5-\u5D4C\u5957\u7684-effect-\u4E0E-effect-\u6808" tabindex="-1"><a class="header-anchor" href="#_4-5-\u5D4C\u5957\u7684-effect-\u4E0E-effect-\u6808" aria-hidden="true">#</a> 4.5 \u5D4C\u5957\u7684 effect \u4E0E effect \u6808</h2><p>effect \u662F\u53EF\u4EE5\u53D1\u751F\u5D4C\u5957\u7684\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">effect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">effectFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">effectFn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>effectFn1 \u91CC\u5D4C\u5957\u4E86 effectFn2\uFF0C\u4EC0\u4E48\u573A\u666F\u4F1A\u6709\u5462\uFF1F\u6BD4\u5982\uFF0CFoo \u7EC4\u4EF6\u6709 effect\uFF0CFoo \u7EC4\u4EF6\u91CC\u8C03\u7528\u4E86 Bar \u7EC4\u4EF6\uFF0C Bar \u91CC\u6709 effect \u7684\u8BDD\uFF0C\u5C31\u4F1A\u53D1\u9001 effect \u5D4C\u5957\u3002</p><p>\u4F46\u662F\uFF0C\u524D\u9762\u7684\u4EE3\u7801\u4E2D\uFF0C\u5168\u5C40\u53D8\u91CF activeEffect \u53EA\u80FD\u5B58\u50A8\u4E00\u4E2A\uFF0C\u6709\u5D4C\u5957\u65F6\u4E0D\u80FD\u6B63\u786E\u7684\u6062\u590D\u5916\u5C42\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002</p><p>\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u526F\u4F5C\u7528\u6808 effectStack\uFF0C\u5728\u526F\u4F5C\u7528\u51FD\u6570\u6267\u884C\u65F6\uFF0C\u5C06\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u538B\u5165\u6808\u4E2D\uFF0C\u5F85\u526F\u4F5C\u7528\u51FD\u6570\u6267\u884C\u5B8C\u6BD5\u540E\u5C06\u5176\u4ECE\u6808\u4E2D\u5F39\u51FA\uFF0C\u5E76\u59CB\u7EC8\u8BA9 activeEffect \u6307\u5411\u6808\u9876\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002 \u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u7528\u4E00\u4E2A\u5168\u5C40\u53D8\u91CF\u5B58\u50A8\u88AB\u6CE8\u518C\u7684\u526F\u4F5C\u7528\u51FD\u6570</span>
<span class="token keyword">let</span> activeEffect
<span class="token comment">// effect \u6808</span>
<span class="token keyword">let</span> effectStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">effectFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8C03\u7528 cleanup \u51FD\u6570\u5B8C\u6210\u6E05\u9664\u5DE5\u4F5C</span>
    <span class="token function">cleanup</span><span class="token punctuation">(</span>effectFn<span class="token punctuation">)</span>
    <span class="token comment">// \u5F53\u8C03\u7528 effect \u6CE8\u518C\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u5C06\u526F\u4F5C\u7528\u51FD\u6570\u590D\u5236\u7ED9 activeEffect</span>
    activeEffect <span class="token operator">=</span> effectFn
    <span class="token comment">// \u5728\u8C03\u7528\u526F\u4F5C\u7528\u51FD\u6570\u4E4B\u524D\uFF0C\u5C06\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u538B\u5165\u6808\u4E2D</span>
    effectStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>effectFn<span class="token punctuation">)</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u5728\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u5C06\u5F53\u524D\u526F\u4F5C\u7528\u51FD\u6570\u5F39\u51FA\u6808\uFF0C</span>
    <span class="token comment">// \u5E76\u628A activeEffect \u8FD8\u539F\u4E3A\u4E4B\u524D\u7684\u503C</span>
    effectStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    activeEffect <span class="token operator">=</span> effectStack<span class="token punctuation">[</span>effectStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// effectFn.deps \u7528\u6765\u5B58\u50A8\u6240\u6709\u4E0E\u8BE5\u526F\u4F5C\u7528\u51FD\u6570\u76F8\u5173\u8054\u7684\u4F9D\u8D56\u96C6\u5408</span>
  effectFn<span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// \u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570</span>
  <span class="token function">effectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_4-6-\u907F\u514D\u65E0\u9650\u9012\u5F52\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#_4-6-\u907F\u514D\u65E0\u9650\u9012\u5F52\u5FAA\u73AF" aria-hidden="true">#</a> 4.6 \u907F\u514D\u65E0\u9650\u9012\u5F52\u5FAA\u73AF</h2><p>\u5F53\u6709\u5982\u4E0B\u7684\u4EE3\u7801\u65F6\uFF0C\u4F1A\u53D1\u751F\u65E0\u9650\u9012\u5F52\u5FAA\u73AF\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">.</span>foo<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token comment">// \u4E0A\u53E5\u76F8\u5F53\u4E8E</span>
<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5728\u526F\u4F5C\u7528\u4E2D\uFF0C\u65E2\u8BFB\u53D6 obj.foo\uFF0C\u53C8\u8BBE\u7F6E obj.foo\uFF0C\u8BFB\u53D6\u4F1A\u89E6\u53D1 track \u64CD\u4F5C\uFF0C\u5C06\u526F\u4F5C\u7528\u51FD\u6570\u653E\u5165\u6876\u4E2D\uFF1B\u8BBE\u7F6E\u4F1A\u89E6\u53D1 trigger\uFF0C\u4ECE\u6876\u4E2D\u53D6\u51FA\u526F\u4F5C\u7528\u51FD\u6570\u5E76\u6267\u884C\u3002</p><p>\u4F46\u95EE\u9898\u662F\u8BE5\u526F\u4F5C\u7528\u51FD\u6570\u6B63\u5728\u6267\u884C\u4E2D\uFF0C\u8FD8\u6CA1\u6267\u884C\u5B8C\u6BD5\uFF0C\u5C31\u8981\u5F00\u59CB\u4E0B\u4E00\u6B21\u7684\u6267\u884C\u3002\u8FD9\u5C06\u4F1A\u5BFC\u81F4\u65E0\u9650\u9012\u5F52\u8C03\u7528\u81EA\u5DF1\uFF0C\u4EA7\u751F\u6808\u6EA2\u51FA\u3002</p><p>\u901A\u8FC7\u5206\u6790\u53D1\u73B0\uFF0C\u8BFB\u53D6\u548C\u8BBE\u7F6E\u64CD\u4F5C\u662F\u5728\u540C\u4E00\u4E2A\u526F\u4F5C\u7528\u51FD\u6570\u5185\u8FDB\u884C\u7684\u3002\u4E0D\u7BA1\u662F track \u6536\u96C6\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u8FD8\u662F trigger \u6267\u884C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u90FD\u662F activeEffect\u3002 \u57FA\u4E8E\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u52A0\u4E2A\u6761\u4EF6\uFF0C<strong>\u5982\u679C trigger \u6267\u884C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u4E0E\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u76F8\u540C\uFF0C\u5219\u4E0D\u89E6\u53D1\u6267\u884C</strong>\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> depsMap <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> effects <span class="token operator">=</span> depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

  <span class="token comment">// \u6784\u9020\u4E00\u4E2A\u65B0\u7684\u96C6\u5408 effectToRun \u7136\u540E\u53D8\u91CF\u5B83\uFF0C\u7528\u6765\u904D\u5386\u5220\u9664\uFF0C\u907F\u514D\u6B7B\u5FAA\u73AF</span>
  <span class="token keyword">const</span> effectsToRun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  effects <span class="token operator">&amp;&amp;</span>
    effects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effectFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>effectFn <span class="token operator">!==</span> activeEffectFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5982\u679C trigger \u6267\u884C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u4E0E\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u76F8\u540C\uFF0C\u5219\u4E0D\u89E6\u53D1\u6267\u884C</span>
        effectsToRun<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>effectFn<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  effectsToRun<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effectFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">effectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_4-7-\u8C03\u5EA6\u6267\u884C" tabindex="-1"><a class="header-anchor" href="#_4-7-\u8C03\u5EA6\u6267\u884C" aria-hidden="true">#</a> 4.7 \u8C03\u5EA6\u6267\u884C</h2>`,15);function P(R,O){const t=c("CodeDemo"),o=c("ExternalLinkIcon");return l(),u(r,null,[E,a(t,{id:"code-demo-6e1daf30",title:"Proxy%20%E7%A4%BA%E4%BE%8B",code:"%7B%22html%22%3A%22%3Cdiv%20id%3D%5C%22effect-proxy-demo%5C%22%3E%3C%2Fdiv%3E%5Cn%3Cbutton%20onclick%3D%5C%22changeText()%5C%22%3EChange%20Text%3C%2Fbutton%3E%5Cn%22%2C%22js%22%3A%22%2F%2F%20%E5%AD%98%E5%82%A8%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E7%9A%84%E6%A1%B6%5Cnconst%20bucket%20%3D%20new%20Set()%5Cn%5Cn%2F%2F%20%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%5Cnconst%20data%20%3D%20%7B%20text%3A%20'hello%20world'%20%7D%5Cn%2F%2F%20%E5%AF%B9%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BB%A3%E7%90%86%5Cnconst%20obj%20%3D%20new%20Proxy(data%2C%20%7B%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C%5Cn%20%20get(target%2C%20key)%20%7B%5Cn%20%20%20%20%2F%2F%20%E5%B0%86%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%20effect%20%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E6%A1%B6%E4%B8%AD%5Cn%20%20%20%20bucket.add(effect)%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20return%20target%5Bkey%5D%5Cn%20%20%7D%2C%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AE%BE%E7%BD%AE%E6%93%8D%E4%BD%9C%5Cn%20%20set(target%2C%20key%2C%20newVal)%20%7B%5Cn%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20target%5Bkey%5D%20%3D%20newVal%5Cn%20%20%20%20%2F%2F%20%E6%8A%8A%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%87%BA%E6%9D%A5%E5%B9%B6%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20bucket.forEach((fn)%20%3D%3E%20fn())%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%20true%20%E4%BB%A3%E8%A1%A8%20%E8%AE%BE%E7%BD%AE%E6%88%90%E5%8A%9F%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%2C%5Cn%7D)%5Cn%5Cn%2F%2F%20%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cnfunction%20effect()%20%7B%5Cn%20%20window.document.querySelector('%23effect-proxy-demo').innerText%20%3D%20obj.text%5Cn%7D%5Cn%5Cn%2F%2F%20%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E8%A7%A6%E5%8F%91%E8%AF%BB%E5%8F%96%5Cneffect()%5Cn%5Cnfunction%20changeText()%20%7B%5Cn%20%20obj.text%20%3D%20'hello%20vue3'%5Cn%7D%5Cn%22%7D"},{default:e(()=>[b,m]),_:1}),f,a(t,{id:"code-demo-7ce49003",title:"%E6%94%B9%E8%BF%9B%E5%90%8E%E7%9A%84%E7%A4%BA%E4%BE%8B",code:"%7B%22html%22%3A%22%3Cdiv%20id%3D%5C%22effect-proxy-demo2%5C%22%3E%3C%2Fdiv%3E%5Cn%3Cbutton%20onclick%3D%5C%22changeText()%5C%22%3EChange%20Text%3C%2Fbutton%3E%5Cn%22%2C%22js%22%3A%22%2F%2F%20%E7%94%A8%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8%E8%A2%AB%E6%B3%A8%E5%86%8C%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cnlet%20activeEffect%5Cn%5Cn%2F%2F%20effect%20%E5%87%BD%E6%95%B0%E7%94%A8%E4%BA%8E%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cnfunction%20effect(fn)%20%7B%5Cn%20%20%2F%2F%20%E5%BD%93%E8%B0%83%E7%94%A8%20effect%20%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E6%97%B6%EF%BC%8C%E5%B0%86%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%20fn%20%E8%B5%8B%E5%80%BC%E7%BB%99%20activeEffect%5Cn%20%20activeEffect%20%3D%20fn%5Cn%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20fn()%5Cn%7D%5Cn%5Cn%2F%2F%20%E5%AD%98%E5%82%A8%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E7%9A%84%E6%A1%B6%5Cnconst%20bucket%20%3D%20new%20Set()%5Cn%5Cn%2F%2F%20%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%5Cnconst%20data%20%3D%20%7B%20text%3A%20'hello%20world'%20%7D%5Cn%2F%2F%20%E5%AF%B9%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BB%A3%E7%90%86%5Cnconst%20obj%20%3D%20new%20Proxy(data%2C%20%7B%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C%5Cn%20%20get(target%2C%20key)%20%7B%5Cn%20%20%20%20%2F%2F%20%E5%B0%86%20activeEffect%20%E4%B8%AD%E5%AD%98%E5%82%A8%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E6%94%B6%E9%9B%86%E5%88%B0%E6%A1%B6%E4%B8%AD%5Cn%20%20%20%20if%20(activeEffect)%20%7B%5Cn%20%20%20%20%20%20%2F%2F%20%E6%96%B0%E5%A2%9E%5Cn%20%20%20%20%20%20bucket.add(activeEffect)%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20return%20target%5Bkey%5D%5Cn%20%20%7D%2C%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AE%BE%E7%BD%AE%E6%93%8D%E4%BD%9C%5Cn%20%20set(target%2C%20key%2C%20newVal)%20%7B%5Cn%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20target%5Bkey%5D%20%3D%20newVal%5Cn%20%20%20%20%2F%2F%20%E6%8A%8A%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%87%BA%E6%9D%A5%E5%B9%B6%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20bucket.forEach((fn)%20%3D%3E%20fn())%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%20true%20%E4%BB%A3%E8%A1%A8%20%E8%AE%BE%E7%BD%AE%E6%88%90%E5%8A%9F%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%2C%5Cn%7D)%5Cn%5Cn%2F%2F%20%E4%BD%BF%E7%94%A8%20effect%20%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cneffect(()%20%3D%3E%20%7B%5Cn%20%20%2F%2F%20%E5%8C%BF%E5%90%8D%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20console.log('effect%20run')%20%2F%2F%20%E4%BC%9A%E6%89%93%E5%8D%B0%202%20%E6%AC%A1%EF%BC%8C%E6%B3%A8%E5%86%8C%E6%97%B6%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E4%BA%86%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%90%8E%E9%9D%A2%E6%9B%B4%E6%94%B9%20obj.notExist%20%E6%97%B6%E4%BC%9A%E5%86%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1%5Cn%20%20window.document.querySelector('%23effect-proxy-demo2').innerText%20%3D%20obj.text%5Cn%7D)%5Cn%5Cnfunction%20changeText()%20%7B%5Cn%20%20obj.notExist%20%3D%20'hello%20vue3'%5Cn%7D%5Cn%22%7D"},{default:e(()=>[B,d]),_:1}),C,A,F,g,a(t,{id:"code-demo-4f10464b",title:"WeakMap%20%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A1%B6",code:"%7B%22html%22%3A%22%3Cdiv%20id%3D%5C%22effect-proxy-weakmap%5C%22%3E%3C%2Fdiv%3E%5Cn%3Cbutton%20onclick%3D%5C%22changeText()%5C%22%3EChange%20Text%3C%2Fbutton%3E%5Cn%22%2C%22js%22%3A%22%2F%2F%20%E5%85%83%E7%B4%A0%E6%95%B0%E6%8D%AE%5Cnconst%20data%20%3D%20%7B%5Cn%20%20ok%3A%20true%2C%5Cn%20%20text%3A%20'hello%20world'%2C%5Cn%7D%5Cn%5Cn%2F%2F%20%E5%AD%98%E5%82%A8%E5%89%AF%E4%BD%9C%E7%94%A8%E7%9A%84%E6%A1%B6%5Cnconst%20bucket%20%3D%20new%20WeakMap()%5Cnlet%20activeEffect%5Cn%5Cnconst%20obj%20%3D%20new%20Proxy(data%2C%20%7B%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C%5Cn%20%20get(target%2C%20key)%20%7B%5Cn%20%20%20%20%2F%2F%20%E5%B0%86%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%20%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A1%B6%E4%B8%AD%5Cn%20%20%20%20track(target%2C%20key)%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20return%20target%5Bkey%5D%5Cn%20%20%7D%2C%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AE%BE%E7%BD%AE%E6%93%8D%E4%BD%9C%5Cn%20%20set(target%2C%20key%2C%20newVal)%20%7B%5Cn%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20target%5Bkey%5D%20%3D%20newVal%5Cn%20%20%20%20%2F%2F%20%E6%8A%8A%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%87%BA%E5%B9%B6%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20trigger(target%2C%20key)%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%2C%5Cn%7D)%5Cn%5Cn%2F%2F%20%E5%9C%A8%20get%20%E6%8B%A6%E6%88%AA%E5%87%BD%E6%95%B0%E5%86%85%E8%B0%83%E7%94%A8%20track%20%E5%87%BD%E6%95%B0%E8%BF%BD%E8%B8%AA%E5%8F%98%E5%8C%96%5Cnfunction%20track(target%2C%20key)%20%7B%5Cn%20%20%2F%2F%20%E6%B2%A1%E6%9C%89%20activeEffect%20%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%5Cn%20%20if%20(!activeEffect)%20return%5Cn%20%20%2F%2F%20%E6%A0%B9%E6%8D%AE%20target%20%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%BE%97%20depsMap%EF%BC%8C%E5%AE%83%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AA%20Map%20%E7%B1%BB%E5%9E%8B%EF%BC%8Ckey%3A%20effects%5Cn%20%20let%20depsMap%20%3D%20bucket.get(target)%5Cn%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%20depsMap%EF%BC%8C%E5%88%99%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%20Map%20%E4%B8%8E%20target%20%E5%85%B3%E8%81%94%5Cn%20%20if%20(!depsMap)%20%7B%5Cn%20%20%20%20bucket.set(target%2C%20(depsMap%20%3D%20new%20Map()))%5Cn%20%20%7D%5Cn%20%20%2F%2F%20%E5%86%8D%E6%A0%B9%E6%8D%AE%20key%20%E4%BB%8E%20depsMap%20%E4%B8%AD%E5%8F%96%E5%BE%97%20deps%EF%BC%8C%E5%AE%83%E6%98%AF%E4%B8%80%E4%B8%AA%20Set%20%E7%B1%BB%E5%9E%8B%5Cn%20%20%2F%2F%20%E9%87%8C%E9%9D%A2%E5%AD%98%E5%82%A8%E7%9D%80%E6%89%80%E6%9C%89%E4%B8%8E%E5%BD%93%E5%89%8D%20key%20%E5%85%B3%E8%81%94%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%9Aeffects%5Cn%20%20let%20deps%20%3D%20depsMap.get(key)%5Cn%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%20deps%20%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%90%8C%E6%A0%B7%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%20Set%20%E4%B8%8E%20key%20%E5%85%B3%E8%81%94%5Cn%20%20if%20(!deps)%20%7B%5Cn%20%20%20%20depsMap.set(key%2C%20(deps%20%3D%20new%20Set()))%5Cn%20%20%7D%5Cn%20%20%2F%2F%20%E6%9C%80%E5%90%8E%E5%B0%86%E5%BD%93%E5%89%8D%E6%BF%80%E6%B4%BB%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A1%B6%E4%B8%AD%5Cn%20%20deps.add(activeEffect)%5Cn%7D%5Cn%5Cn%2F%2F%20%E5%9C%A8%20set%20%E6%8B%A6%E6%88%AA%E5%87%BD%E6%95%B0%E5%86%85%E8%B0%83%E7%94%A8%20trigger%20%E5%87%BD%E6%95%B0%E5%87%BA%E5%8F%91%E5%8F%98%E5%8C%96%5Cnfunction%20trigger(target%2C%20key)%20%7B%5Cn%20%20%2F%2F%20%E6%A0%B9%E6%8D%AE%20target%20%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%BE%97%20depsMap%EF%BC%8C%E5%AE%83%E6%98%AF%20key%3A%20effects%5Cn%20%20const%20depsMap%20%3D%20bucket.get(target)%5Cn%20%20if%20(!depsMap)%20return%5Cn%20%20%2F%2F%20%E6%A0%B9%E6%8D%AE%20key%20%E5%8F%96%E5%BE%97%E6%89%80%E6%9C%89%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20const%20effects%20%3D%20depsMap.get(key)%5Cn%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20effects%20%26%26%20effects.forEach((fn)%20%3D%3E%20fn())%5Cn%7D%5Cn%5Cn%2F%2F%20effect%20%E5%87%BD%E6%95%B0%E7%94%A8%E4%BA%8E%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cnfunction%20effect(fn)%20%7B%5Cn%20%20%2F%2F%20%E5%BD%93%E8%B0%83%E7%94%A8%20effect%20%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E6%97%B6%EF%BC%8C%E5%B0%86%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%20fn%20%E8%B5%8B%E5%80%BC%E7%BB%99%20activeEffect%5Cn%20%20activeEffect%20%3D%20fn%5Cn%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20fn()%5Cn%7D%5Cn%5Cn%2F%2F%20%E4%BD%BF%E7%94%A8%20effect%20%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cneffect(()%20%3D%3E%20%7B%5Cn%20%20%2F%2F%20%E5%8C%BF%E5%90%8D%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20console.log('effect%20run%20-%20weekmap')%20%2F%2F%20%E4%BC%9A%E6%89%93%E5%8D%B0%202%20%E6%AC%A1%EF%BC%8C%E6%B3%A8%E5%86%8C%E6%97%B6%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E4%BA%86%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%90%8E%E9%9D%A2%E6%9B%B4%E6%94%B9%20obj.text%20%E6%97%B6%E4%BC%9A%E5%86%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1%EF%BC%8Cobj.notExist%20%E4%B8%8D%E6%89%A7%E8%A1%8C%5Cn%20%20window.document.querySelector('%23effect-proxy-weakmap').innerText%20%3D%20obj.text%5Cn%7D)%5Cn%5Cnfunction%20changeText()%20%7B%5Cn%20%20obj.text%20%3D%20'hello%20vue3'%5Cn%20%20obj.notExist%20%3D%20'hello%20vue3'%5Cn%7D%5Cn%22%7D"},{default:e(()=>[D,y]),_:1}),w,v,h,n("p",null,[x,n("a",j,[M,a(o)])]),a(t,{id:"code-demo-6a8e1c5c",title:"Map%20%E5%92%8C%20WeakMap",code:"%7B%22js%22%3A%22const%20map%20%3D%20new%20Map()%5Cnconst%20weakmap%20%3D%20new%20WeakMap()%5Cn%5Cn%3B(function%20()%20%7B%5Cn%20%20const%20foo%20%3D%20%7B%20foo%3A%201%20%7D%5Cn%20%20const%20bar%20%3D%20%7B%20bar%3A%202%20%7D%5Cn%5Cn%20%20map.set(foo%2C%201)%5Cn%20%20weakmap.set(bar%2C%202)%5Cn%7D)()%5Cn%5Cn%2F%2F%20%E5%8F%AF%E4%BB%A5%E6%89%93%E5%8D%B0%E5%87%BA%20foo%EF%BC%8C%E8%AF%B4%E6%98%8E%20foo%20%E6%B2%A1%E6%9C%89%E8%A2%AB%E5%9B%9E%E6%94%B6%5Cnconsole.log('map.keys'%2C%20map.keys().next().value)%5Cn%2F%2F%20WeakMap%20%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%20key%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%20bar%5Cnconsole.log('weakmap'%2C%20weakmap)%5Cn%22%7D"},{default:e(()=>[_,S]),_:1}),T,a(t,{id:"code-demo-324ec0b0",title:"%E5%88%86%E6%94%AF%E5%88%87%E6%8D%A2%E4%B8%8E%20cleanup%20demo",code:"%7B%22html%22%3A%22%3Cdiv%20id%3D%5C%22effect-branch-cleanup%5C%22%3E%3C%2Fdiv%3E%5Cn%3Cbutton%20onclick%3D%5C%22changeText()%5C%22%3EChange%20Text%3C%2Fbutton%3E%5Cn%3Cinput%5Cn%20%20type%3D%5C%22checkbox%5C%22%5Cn%20%20checked%3D%5C%22obj.ok%5C%22%5Cn%20%20onclick%3D%5C%22changeOk(event.target.checked)%5C%22%5Cn%2F%3EChange%20OK%5Cn%22%2C%22js%22%3A%22%2F%2F%20%E5%AD%98%E5%82%A8%E5%89%AF%E4%BD%9C%E7%94%A8%E7%9A%84%E6%A1%B6%5Cnconst%20bucket%20%3D%20new%20WeakMap()%5Cn%2F%2F%20%E7%94%A8%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8%E8%A2%AB%E6%B3%A8%E5%86%8C%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cnlet%20activeEffect%5Cn%5Cnfunction%20effect(fn)%20%7B%5Cn%20%20const%20effectFn%20%3D%20()%20%3D%3E%20%7B%5Cn%20%20%20%20%2F%2F%20%E8%B0%83%E7%94%A8%20cleanup%20%E5%87%BD%E6%95%B0%E5%AE%8C%E6%88%90%E6%B8%85%E9%99%A4%E5%B7%A5%E4%BD%9C%5Cn%20%20%20%20cleanup(effectFn)%5Cn%20%20%20%20%2F%2F%20%E5%BD%93%20effectFn%20%E6%89%A7%E8%A1%8C%E6%97%B6%EF%BC%8C%E5%B0%86%E5%85%B6%E8%AE%BE%E4%B8%BA%E5%BD%93%E5%89%8D%E6%BF%80%E6%B4%BB%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20%20%20activeEffect%20%3D%20effectFn%5Cn%20%20%20%20fn()%5Cn%20%20%7D%5Cn%20%20%2F%2F%20effectFn.deps%20%E7%94%A8%E6%9D%A5%E5%AD%98%E5%82%A8%E6%89%80%E6%9C%89%E4%B8%8E%E8%AF%A5%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E7%9B%B8%E5%85%B3%E8%81%94%E7%9A%84%E4%BE%9D%E8%B5%96%E9%9B%86%E5%90%88%5Cn%20%20effectFn.deps%20%3D%20%5B%5D%5Cn%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20effectFn()%5Cn%7D%5Cn%5Cnfunction%20track(target%2C%20key)%20%7B%5Cn%20%20%2F%2F%20%E6%B2%A1%E6%9C%89%20activeEffect%20%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%5Cn%20%20if%20(!activeEffect)%20return%5Cn%20%20%2F%2F%20%E6%A0%B9%E6%8D%AE%20target%20%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%BE%97%20depsMap%EF%BC%8C%E5%AE%83%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AA%20Map%20%E7%B1%BB%E5%9E%8B%EF%BC%8Ckey%3A%20effects%5Cn%20%20let%20depsMap%20%3D%20bucket.get(target)%5Cn%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%20depsMap%EF%BC%8C%E5%88%99%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%20Map%20%E4%B8%8E%20target%20%E5%85%B3%E8%81%94%5Cn%20%20if%20(!depsMap)%20%7B%5Cn%20%20%20%20bucket.set(target%2C%20(depsMap%20%3D%20new%20Map()))%5Cn%20%20%7D%5Cn%20%20%2F%2F%20%E5%86%8D%E6%A0%B9%E6%8D%AE%20key%20%E4%BB%8E%20depsMap%20%E4%B8%AD%E5%8F%96%E5%BE%97%20deps%EF%BC%8C%E5%AE%83%E6%98%AF%E4%B8%80%E4%B8%AA%20Set%20%E7%B1%BB%E5%9E%8B%5Cn%20%20%2F%2F%20%E9%87%8C%E9%9D%A2%E5%AD%98%E5%82%A8%E7%9D%80%E6%89%80%E6%9C%89%E4%B8%8E%E5%BD%93%E5%89%8D%20key%20%E5%85%B3%E8%81%94%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%9Aeffects%5Cn%20%20let%20deps%20%3D%20depsMap.get(key)%5Cn%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%20deps%20%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%90%8C%E6%A0%B7%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%20Set%20%E4%B8%8E%20key%20%E5%85%B3%E8%81%94%5Cn%20%20if%20(!deps)%20%7B%5Cn%20%20%20%20depsMap.set(key%2C%20(deps%20%3D%20new%20Set()))%5Cn%20%20%7D%5Cn%20%20%2F%2F%20%E6%8A%8A%E5%BD%93%E5%89%8D%E6%BF%80%E6%B4%BB%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%BE%9D%E8%B5%96%E9%9B%86%E5%90%88%20deps%20%E4%B8%AD%5Cn%20%20deps.add(activeEffect)%5Cn%20%20%2F%2F%20deps%20%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%8E%E5%BD%93%E5%89%8D%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E5%AD%98%E5%9C%A8%E8%81%94%E7%B3%BB%E7%9A%84%E4%BE%9D%E8%B5%96%E9%9B%86%E5%90%88%5Cn%20%20%2F%2F%20%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%20activeEffect.deps%20%E6%95%B0%E7%BB%84%E4%B8%AD%5Cn%20%20activeEffect.deps.push(deps)%5Cn%7D%5Cn%5Cnfunction%20cleanup(effectFn)%20%7B%5Cn%20%20%2F%2F%20%E9%81%8D%E5%8E%86%20effectFn%20%E7%9A%84%20deps%20%E6%95%B0%E7%BB%84%5Cn%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20effectFn.deps.length%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%2F%2F%20deps%20%E6%98%AF%E4%BE%9D%E8%B5%96%E9%9B%86%E5%90%88%5Cn%20%20%20%20const%20deps%20%3D%20effectFn.deps%5Bi%5D%5Cn%20%20%20%20%2F%2F%20%E5%B0%86%20effectFn%20%E4%BB%8E%E4%BE%9D%E8%B5%96%E9%9B%86%E5%90%88%E4%B8%AD%E7%A7%BB%E9%99%A4%5Cn%20%20%20%20deps.delete(effectFn)%5Cn%20%20%7D%5Cn%20%20%2F%2F%20%E6%9C%80%E5%90%8E%E9%9C%80%E8%A6%81%E9%87%8D%E7%BD%AE%20effectFn.deps%20%E6%95%B0%E7%BB%84%5Cn%20%20effectFn.deps.length%20%3D%200%5Cn%7D%5Cn%5Cnfunction%20trigger(target%2C%20key)%20%7B%5Cn%20%20const%20depsMap%20%3D%20bucket.get(target)%5Cn%20%20if%20(!depsMap)%20%7B%5Cn%20%20%20%20return%5Cn%20%20%7D%5Cn%20%20const%20effects%20%3D%20depsMap.get(key)%5Cn%20%20%2F%2F%20effects%20%26%26%20effects.forEach(fn%20%3D%3E%20fn())%20%2F%2F%20%E5%88%A0%E9%99%A4%EF%BC%8C%E8%BF%99%E4%B8%AA%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%AD%BB%E5%BE%AA%E7%8E%AF%5Cn%5Cn%20%20%2F%2F%20%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E9%9B%86%E5%90%88%20effectToRun%20%E7%84%B6%E5%90%8E%E5%8F%98%E9%87%8F%E5%AE%83%EF%BC%8C%E7%94%A8%E6%9D%A5%E9%81%8D%E5%8E%86%E5%88%A0%E9%99%A4%EF%BC%8C%E9%81%BF%E5%85%8D%E6%AD%BB%E5%BE%AA%E7%8E%AF%5Cn%20%20const%20effectToRun%20%3D%20new%20Set(effects)%5Cn%20%20effectToRun.forEach((effectFn)%20%3D%3E%20effectFn())%5Cn%7D%5Cn%5Cn%2F%2F%20%E5%85%83%E7%B4%A0%E6%95%B0%E6%8D%AE%5Cnconst%20data%20%3D%20%7B%5Cn%20%20ok%3A%20true%2C%5Cn%20%20text%3A%20'hello%20world'%2C%5Cn%7D%5Cn%5Cnconst%20obj%20%3D%20new%20Proxy(data%2C%20%7B%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C%5Cn%20%20get(target%2C%20key)%20%7B%5Cn%20%20%20%20%2F%2F%20%E5%B0%86%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%20%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A1%B6%E4%B8%AD%5Cn%20%20%20%20track(target%2C%20key)%5Cn%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20return%20target%5Bkey%5D%5Cn%20%20%7D%2C%5Cn%20%20%2F%2F%20%E6%8B%A6%E6%88%AA%E8%AE%BE%E7%BD%AE%E6%93%8D%E4%BD%9C%5Cn%20%20set(target%2C%20key%2C%20newVal)%20%7B%5Cn%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC%5Cn%20%20%20%20target%5Bkey%5D%20%3D%20newVal%5Cn%20%20%20%20%2F%2F%20%E6%8A%8A%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8E%E6%A1%B6%E4%B8%AD%E5%8F%96%E5%87%BA%E5%B9%B6%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20trigger(target%2C%20key)%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%2C%5Cn%7D)%5Cn%5Cn%2F%2F%20%E4%BD%BF%E7%94%A8%20effect%20%E6%B3%A8%E5%86%8C%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cneffect(()%20%3D%3E%20%7B%5Cn%20%20%2F%2F%20%E5%8C%BF%E5%90%8D%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%5Cn%20%20console.log('effect%20run%20-%20branch-cleanup')%5Cn%20%20window.document.querySelector('%23effect-branch-cleanup').innerText%20%3D%20obj.ok%5Cn%20%20%20%20%3F%20obj.text%5Cn%20%20%20%20%3A%20'not'%5Cn%7D)%5Cn%5Cnfunction%20changeText()%20%7B%5Cn%20%20obj.text%20%3D%20'hello%20vue3'%5Cn%20%20obj.notExist%20%3D%20'hello%20vue3'%5Cn%7D%5Cn%5Cnfunction%20changeOk(val)%20%7B%5Cn%20%20obj.ok%20%3D%20val%5Cn%7D%5Cn%22%7D"},{default:e(()=>[V,q]),_:1}),W],64)}var I=i(k,[["render",P],["__file","chapter04.html.vue"]]);export{I as default};
