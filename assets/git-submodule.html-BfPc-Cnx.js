import{_ as i,c as a,a as e,o as t}from"./app-BLGi6crg.js";const l={};function h(n,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="git-submodule-使用" tabindex="-1"><a class="header-anchor" href="#git-submodule-使用"><span>git submodule 使用</span></a></h1><h2 id="为什么" tabindex="-1"><a class="header-anchor" href="#为什么"><span>为什么</span></a></h2><p>本仓库代码是公开的，但是有时候又想保存一些个人私有资料，又希望跟本站一起发布。<br> Hope 主题已具备加密访问功能，剩下的就是怎么保存私有的 MD 文件了。<br> 此时想到了 git submodule，将私有仓库作为本仓库的一个文件夹，然后通过 git submodule 关联过来，<br> 这时候再跟本站一起发布应该可以达到想要的效果。</p><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><h3 id="事先设置" tabindex="-1"><a class="header-anchor" href="#事先设置"><span>事先设置</span></a></h3><p>先设置 <code>submodule.recurse</code>，以便使用 <code>git clone</code>, <code>git pull</code> 时同步更新子模块。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --global</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule.recurse</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span></code></pre></div><h3 id="添加子模块" tabindex="-1"><a class="header-anchor" href="#添加子模块"><span>添加子模块</span></a></h3><div class="hint-container warning"><p class="hint-container-title">注意</p><p>私有仓库作为子模块的话，本地使用的话，建议使用 <code>SSH</code> 协议，不然更新起来比较麻烦，得使用 <code>PAT</code>。</p></div><p>比如，本站想把一个私有仓库 <code>https://github.com/FuckDoctors/private-notes</code>，放到 <code>docs/posts/private</code> 下面。</p><p>先进到 <code>docs/posts</code> 下面，然后执行下面的命令。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git@github.com:FuckDoctors/private-notes.git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> private</span></span></code></pre></div><p>上面 <code>-b main</code> 是指定了 <code>main</code> 分支。</p><p>小插曲，一开始不知怎么回事，<code>git submodule add</code> 老不成功，即使使用了 <code>-f</code> 也不行，<code>git submodule deinit</code> 也不行。<br> 后来手动删除了 <code>.git/modules</code> 文件夹，然后重新执行 <code>git submodule add</code> 就可以了。</p><p>执行成功后，会自动生成一个 <code>.gitmodules</code> 文件，大概长下面这样。</p><div class="language-txt" data-highlighter="shiki" data-ext="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-txt"><span class="line"><span>[submodule &quot;docs/posts/private&quot;]</span></span>
<span class="line"><span>  path = docs/posts/private</span></span>
<span class="line"><span>  url = git@github.com:FuckDoctors/private-notes.git</span></span>
<span class="line"><span>  branch = main</span></span></code></pre></div><p>同时，<code>docs/posts</code> 下面会多一个 <code>private</code> 文件夹。</p><h3 id="更新一个子模块" tabindex="-1"><a class="header-anchor" href="#更新一个子模块"><span>更新一个子模块</span></a></h3><p>进到子模块目录 <code>docs/posts/private</code> ，然后执行下面的命令。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --remote</span></span></code></pre></div><h3 id="更新所有子模块" tabindex="-1"><a class="header-anchor" href="#更新所有子模块"><span>更新所有子模块</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> foreach</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --recursive</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --remote</span></span></code></pre></div><h3 id="删除子模块" tabindex="-1"><a class="header-anchor" href="#删除子模块"><span>删除子模块</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deinit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [&lt;path&gt;]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [&lt;path&gt;]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .git/modules/[</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">h&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span></span></code></pre></div><h3 id="列出子模块" tabindex="-1"><a class="header-anchor" href="#列出子模块"><span>列出子模块</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span></span></code></pre></div><h3 id="列出子模块状态" tabindex="-1"><a class="header-anchor" href="#列出子模块状态"><span>列出子模块状态</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span></span></code></pre></div><h3 id="更改子模块的-url" tabindex="-1"><a class="header-anchor" href="#更改子模块的-url"><span>更改子模块的 url</span></a></h3><p>新版 git 可以直接使用下面的命令：</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set-url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">h&gt; &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">newur</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">l&gt;</span></span></code></pre></div><p>旧版的话，需要删除子模块，然后重新添加。</p><h2 id="包含私有子模块发布" tabindex="-1"><a class="header-anchor" href="#包含私有子模块发布"><span>包含私有子模块发布</span></a></h2><p>当仓库中含有私有的子模块时，需要指定一个只读的 <code>PAT</code>，然后使用 <code>HTTPS</code> 方式来访问。</p><h3 id="github-action" tabindex="-1"><a class="header-anchor" href="#github-action"><span>Github Action</span></a></h3><p><a href="https://github.com/actions/checkout" target="_blank" rel="noopener noreferrer">actions/checkout</a> 本身就支持子模块。</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Personal access token (PAT) used to fetch the repository. The PAT is configured</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # with the local git config, which enables your scripts to run authenticated git</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # commands. The post-job step removes the PAT.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # We recommend using a service account with the least permissions necessary. Also</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # when generating a new PAT, select the least scopes necessary.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # [Learn more about creating and using encrypted secrets](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Default: \${{ github.token }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Whether to checkout submodules: \`true\` to checkout submodules or \`recursive\` to</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # recursively checkout submodules.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # When the \`ssh-key\` input is not provided, SSH URLs beginning with</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # \`git@github.com:\` are converted to HTTPS.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Default: false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    submodules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre></div><h3 id="vercel" tabindex="-1"><a class="header-anchor" href="#vercel"><span>Vercel</span></a></h3><p>Vercel 貌似暂不支持私有子模块。<a href="https://vercel.com/docs/builds/build-features#git-submodules" target="_blank" rel="noopener noreferrer">Build Features for Customizing Deployments</a></p><blockquote><p>On Vercel, you can deploy Git submodules with a Git provider as long as the submodule is publicly accessible through the HTTP protocol. Git submodules that are private or requested over SSH will fail during the Build step. However, you can reference private repositories formatted as npm packages in your package.json file dependencies.</p></blockquote><p>可以在 Vercel Checkout 完了之后，更改子模块的原来的 <code>SSH</code> 协议的 url 为 带有 <code>PAT</code> 的 <code>HTTPS</code>，或者删除子模块重新创建。</p><p>可以参考这篇文章：<a href="https://www.ytyng.com/en/blog/how-to-deploy-project-to-vercel-includes-private-submodules" target="_blank" rel="noopener noreferrer">How to Deploy a Project with Private Git Submodules to Vercel</a></p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h2><ul><li><a href="https://zhuanlan.zhihu.com/p/408319831" target="_blank" rel="noopener noreferrer">Github Actions: submodule 下公私有仓库授权和通信</a></li><li><a href="https://git-scm.com/docs/git-submodule" target="_blank" rel="noopener noreferrer">git-submodule</a></li><li><a href="https://www.taniarascia.com/git-submodules-private-content/" target="_blank" rel="noopener noreferrer">Using Git Submodules for Private Content</a></li><li><a href="https://docs.readthedocs.com/platform/stable/guides/private-submodules.html" target="_blank" rel="noopener noreferrer">How to use private Git submodules</a></li></ul>`,44)])])}const r=i(l,[["render",h]]),o=JSON.parse('{"path":"/posts/dev/git-submodule.html","title":"git submodule 使用","lang":"zh-CN","frontmatter":{"article":true,"date":"2025-07-23T00:00:00.000Z","category":["dev"],"tag":["dev","开发"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"git submodule 使用\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-07-23T00:00:00.000Z\\",\\"dateModified\\":\\"2025-07-23T10:20:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zhao Bin\\",\\"url\\":\\"zhaobc.site\\",\\"email\\":\\"hi@zhaobc.site\\"}]}"],["meta",{"property":"og:url","content":"https://www.zhaobc.site/posts/dev/git-submodule.html"}],["meta",{"property":"og:site_name","content":"赵斌的小站"}],["meta",{"property":"og:title","content":"git submodule 使用"}],["meta",{"property":"og:description","content":"git submodule 使用 为什么 本仓库代码是公开的，但是有时候又想保存一些个人私有资料，又希望跟本站一起发布。 Hope 主题已具备加密访问功能，剩下的就是怎么保存私有的 MD 文件了。 此时想到了 git submodule，将私有仓库作为本仓库的一个文件夹，然后通过 git submodule 关联过来， 这时候再跟本站一起发布应该可以达..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-23T10:20:59.000Z"}],["meta",{"property":"article:tag","content":"开发"}],["meta",{"property":"article:tag","content":"dev"}],["meta",{"property":"article:published_time","content":"2025-07-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-23T10:20:59.000Z"}],["meta",{"name":"description","content":"git submodule"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://www.zhaobc.site/rss.xml","title":"赵斌的小站 RSS Feed"}]],"description":"git submodule 使用 为什么 本仓库代码是公开的，但是有时候又想保存一些个人私有资料，又希望跟本站一起发布。 Hope 主题已具备加密访问功能，剩下的就是怎么保存私有的 MD 文件了。 此时想到了 git submodule，将私有仓库作为本仓库的一个文件夹，然后通过 git submodule 关联过来， 这时候再跟本站一起发布应该可以达..."},"git":{"createdTime":1753238487000,"updatedTime":1753266059000,"contributors":[{"name":"Zhao Bin","username":"","email":"413853119@qq.com","commits":2}]},"readingTime":{"minutes":2.91,"words":873},"filePathRelative":"posts/dev/git-submodule.md","excerpt":"\\n<h2>为什么</h2>\\n<p>本仓库代码是公开的，但是有时候又想保存一些个人私有资料，又希望跟本站一起发布。<br>\\nHope 主题已具备加密访问功能，剩下的就是怎么保存私有的 MD 文件了。<br>\\n此时想到了 git submodule，将私有仓库作为本仓库的一个文件夹，然后通过 git submodule 关联过来，<br>\\n这时候再跟本站一起发布应该可以达到想要的效果。</p>\\n<h2>使用</h2>\\n<h3>事先设置</h3>\\n<p>先设置 <code>submodule.recurse</code>，以便使用 <code>git clone</code>, <code>git pull</code> 时同步更新子模块。</p>","autoDesc":true}');export{r as comp,o as data};
