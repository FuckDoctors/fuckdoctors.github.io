import{_ as a,c as e,o as n,d as s}from"./app-DiFm4OjS.js";const i={},t=s(`<h1 id="更新-openmediavault" tabindex="-1"><a class="header-anchor" href="#更新-openmediavault"><span>更新 OpenMediaVault</span></a></h1><p>很久之前折腾过的 N1 盒子，一直默默运行着，用处不大所以一直没再折腾，最近孩子听课，在家看孩子，想看电视时，拔掉 USB 运行原来的盒子系统，用来做电视盒子。<br> 摸了几次 N1 盒子后才想着是不是该升级一下了，于是又开始了折腾。。</p><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>之前折腾 newifi-d3 时逛恩山论坛，看到有人折腾 N1 盒子，看着能运行 linux 系统，还能做 NAS 所以从 PDD 上买了一个，同时也从海鲜市场上买了一个移动硬盘，被骗了一个相当老的影片，运行时间长，速度还慢。。</p><p>经过折腾，安装了 armbian, docker, nextcloud，理论上可做下载机，小型 NAS，但是没怎么用，偶尔用来做 win 和 macOS 的中转站。<br> 安装 armbian 的过程已经不记得了，网上可搜到很多。</p><h2 id="遇到的问题和解决办法" tabindex="-1"><a class="header-anchor" href="#遇到的问题和解决办法"><span>遇到的问题和解决办法</span></a></h2><h3 id="omv-源" tabindex="-1"><a class="header-anchor" href="#omv-源"><span>omv 源</span></a></h3><p>omv 比较慢，可以更换清华源：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/openmediavault/" target="_blank" rel="noopener noreferrer">https://mirrors.tuna.tsinghua.edu.cn/help/openmediavault/</a></p><p>但是使用 omv-env 命令时报错了，后来手动改的 /etc/apt/source.list 文件。</p><p>但是配置完了之后执行 apt update 和 apt upgrade 时报错，导致后面一直升级不成功，再后来又可以 使用 omv-env 命令了，重做了一遍，注意要做签名验证。</p><p>过程中遇到的错误： Package openmediavault is not configured yet.</p><p>解决办法：</p><ol><li>清空或删除 /var/lib/dpkg/info/</li><li>执行 apt clean apt autreomove</li><li>重新执行 apt upgrade</li></ol><h3 id="wifi-网络不可用" tabindex="-1"><a class="header-anchor" href="#wifi-网络不可用"><span>Wifi 网络不可用</span></a></h3><p>升级完 omv 后，登录进去提示要重启系统，悲催的是重启完后连不上 N1 了，插拔了几次电源后也不行。<br> 以为是卡在启动了，然后给 N1 插上键盘，插上显示器看了一下，启动正常，可以本机登录，但有个错误写着网络有问题。</p><p>看路由器上也没显示 N1 连接 Wifi，执行 armbian-config 看了一下，发现居然没有了 Wifi 选项，试了 nmtui 添加 Wifi 但是还是不行。<br> 按网上资料准备手动填写 /etc/network/interfaces 时，发现上面写着不要手动修改， omv 会覆盖掉，于是准备进 omv 设置网络。</p><p>接着给 N1 插上 网线，然后看到 路由器上 N1 上线了，根据 IP 进入了 omv，找到 网络，发现又 WiFi 配置，但是不能点应用，于是修改了下有线网络，点击应用后，稍等一会终于连上 WifFi 了。</p><h3 id="升级-php" tabindex="-1"><a class="header-anchor" href="#升级-php"><span>升级 PHP</span></a></h3><p>升级了一些软件后发现 nextcloud 连不上了，重定向后的地址不对，于是想着干脆升级一下得了。</p><p>查询了一下看到官方推荐 PHP8 ，看着现在的 PHP7.3 就想着升级一下。</p><p>根据下面的资料，准备升级 PHP：</p><ul><li><a href="https://www.linuxandubuntu.com/home/install-php-8-1-in-debian-9-10-and-debian-11" target="_blank" rel="noopener noreferrer">Install PHP 8.1 In Debian 9, 10, and Debian 11</a></li><li><a href="https://bobcares.com/blog/install-php-8-on-debian-10/" target="_blank" rel="noopener noreferrer">Install PHP 8 on Debian 10/Debian 9 – How to do it</a></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> apt-transport-https lsb-release ca-certificates <span class="token function">wget</span> <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
<span class="token comment"># wget -qO – https://packages.sury.org/php/apt.gpg | sudo apt-key add –</span>
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;echo &quot;deb https://packages.sury.org/php/ $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/php.list&#39;</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>又报错了： Package php7.3-common is not configured yet.</p><p>解决：<a href="https://askubuntu.com/questions/1126823/error-while-installing-php-in-ubuntu" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/1126823/error-while-installing-php-in-ubuntu</a></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/info/php*
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token parameter variable">-f</span> <span class="token function">install</span>

<span class="token comment"># Then again for libapache2-mod-php</span>
<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/info/libapache2-mod-php*
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token parameter variable">-f</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>终于升级成功，但是 php -v 还是 7.3 ，发现两个版本共存了。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">ls</span> <span class="token parameter variable">-la</span> /usr/bin <span class="token operator">|</span> <span class="token function">grep</span> php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="切换-php-版本" tabindex="-1"><a class="header-anchor" href="#切换-php-版本"><span>切换 PHP 版本</span></a></h3><p>查看 php 又多个，执行 php8.1 -v 是没问题的，需要修改默认的版本，默认的版本 /etc/alternatives/php</p><p>根据以下资料做修改：</p><ul><li><a href="https://cloud.tencent.com/developer/article/1532283" target="_blank" rel="noopener noreferrer">update-alternatives——linux 软件版本管理命令</a></li><li><a href="https://tecadmin.net/switch-between-multiple-php-version-on-ubuntu/" target="_blank" rel="noopener noreferrer">How to Switch between Multiple PHP Version on Ubuntu</a></li><li><a href="https://www.mf8.biz/ubuntu-multip-php/" target="_blank" rel="noopener noreferrer">Ubuntu 下轻松实现 PHP 多版本共存</a></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>update-alternatives <span class="token parameter variable">--install</span> /usr/bin/php php /usr/bin/php8.1 <span class="token number">200</span>

update-alternatives <span class="token parameter variable">--install</span> /usr/bin/php-cgi php-cgi /usr/bin/php-cgi8.1 <span class="token number">200</span>

update-alternatives <span class="token parameter variable">--install</span> /usr/bin/phar phar /usr/bin/phar8.1 <span class="token number">200</span>

update-alternatives <span class="token parameter variable">--install</span> /usr/bin/phar.phar phar.phar /usr/bin/phar8.1.phar <span class="token number">200</span>

<span class="token comment"># 查看</span>
update-alternatives <span class="token parameter variable">--display</span> php
<span class="token comment"># 配置</span>
update-alternatives <span class="token parameter variable">--config</span> php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置好上面的 update-alternatives 后，查看 php -v 已经切换为 php8.1。</p><p>切换 apache 的 php：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> a2dismod php7.3
<span class="token function">sudo</span> a2enmod php8.1
<span class="token function">sudo</span> <span class="token function">service</span> apache2 restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="升级-nextcloud" tabindex="-1"><a class="header-anchor" href="#升级-nextcloud"><span>升级 NextCloud</span></a></h2><h3 id="command-line" tabindex="-1"><a class="header-anchor" href="#command-line"><span>command line</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token parameter variable">-u</span> www-data php /var/www/html/nextcloud/updater/updater.phar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="installer" tabindex="-1"><a class="header-anchor" href="#installer"><span>Installer</span></a></h3><p>使用 setup-nextcloud.php，放到 /var/www/html 下，并修改 http server 权限：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">chown</span> <span class="token parameter variable">-R</span> www-data:www-data /var/www/html/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>报找不到相应的 php module，但是这些 module 已经安装了。。</p><p>/etc/php/8.1/mods-available 下 比 /etc/php/7.3/mods-available 下少很多。</p><p>接着需要配置 php.ini，php.ini 有多处：</p><ul><li>/etc/php/7.3/apache2/php.ini</li><li>/etc/php/7.3/fpm/php.ini</li><li>/etc/php/7.3/cgi/php.ini</li><li>/etc/php/7.3/cli/php.ini</li></ul><p>但 php8.1 中没有 php.ini，上面的 7.3 的 php.ini 中，虽然有写明 <a href="http://extension=xxx.so" target="_blank" rel="noopener noreferrer">extension=xxx.so</a> 这样，但是都是注释掉的状态，extension_dir 也没有设置。<br> 8.1 默认 extension_dr:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>php <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> extension_dir
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启用哪些模块，可以在 php.ini 中定义，也可以使用命令： <a href="https://tecadmin.net/enable-disable-php-modules-ubuntu/" target="_blank" rel="noopener noreferrer">How to enable or disable PHP Modules on Ubuntu</a></p><ul><li>phpenmod – Used to enable modules in PHP</li><li>phpdismod – Used to disable modules in PHP</li><li>phpquery – Used to view status of modules of PHP</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">### Syntax</span>
phpenmod MODULE_NAME

<span class="token comment">### Enable mbstring php module</span>
phpenmod mbstring

<span class="token comment">### Syntax</span>
phpenmod <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>PHP VERSION<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>MODULE NAME<span class="token operator">&gt;</span>

<span class="token comment">### Enable module for specific php version</span>
phpenmod <span class="token parameter variable">-v</span> <span class="token number">5.6</span> mbstring
phpenmod <span class="token parameter variable">-v</span> <span class="token number">7.4</span> mbstring

<span class="token comment">### Syntax</span>
phpenmod <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>SAPI<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>MODULE NAME<span class="token operator">&gt;</span>

<span class="token comment">### Enable module for specific SAPI</span>
phpenmod <span class="token parameter variable">-s</span> cli mbstring
phpenmod <span class="token parameter variable">-s</span> fpm mbstring
phpenmod <span class="token parameter variable">-s</span> apache2 mbstring
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 7.3 开启的模块： php7.3 -v，然后根据需要开启 php8.1 的模块</p><p>使用 phpenmod 前，需要先在 /etc/php/8.1/mods-available 下建 对应的 .ini 文件。<br> 为了省事，把 /etc/php/7.3/mods-available/* 复制到 /etc/php/8.1/mods-available 下。</p><p>然后重启 apache2, systemctl restart apache2.</p>`,54),p=[t];function l(r,o){return n(),e("div",null,p)}const c=a(i,[["render",l],["__file","upgrade-omv.html.vue"]]),u=JSON.parse('{"path":"/posts/n1/upgrade-omv.html","title":"更新 OpenMediaVault","lang":"zh-CN","frontmatter":{"article":true,"date":"2022-04-20T00:00:00.000Z","category":["armbian"],"tag":["armbian","n1","omv"],"head":[["meta",{"name":"description","content":"更新openmediavault"}],["meta",{"property":"og:url","content":"https://www.zhaobc.site/posts/n1/upgrade-omv.html"}],["meta",{"property":"og:site_name","content":"赵斌的小站"}],["meta",{"property":"og:title","content":"更新 OpenMediaVault"}],["meta",{"property":"og:description","content":"更新 OpenMediaVault 很久之前折腾过的 N1 盒子，一直默默运行着，用处不大所以一直没再折腾，最近孩子听课，在家看孩子，想看电视时，拔掉 USB 运行原来的盒子系统，用来做电视盒子。 摸了几次 N1 盒子后才想着是不是该升级一下了，于是又开始了折腾。。 简介 之前折腾 newifi-d3 时逛恩山论坛，看到有人折腾 N1 盒子，看着能运行..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-04-27T14:01:51.000Z"}],["meta",{"property":"article:author","content":"Zhao Bin"}],["meta",{"property":"article:tag","content":"armbian"}],["meta",{"property":"article:tag","content":"n1"}],["meta",{"property":"article:tag","content":"omv"}],["meta",{"property":"article:published_time","content":"2022-04-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2022-04-27T14:01:51.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"更新 OpenMediaVault\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-04-20T00:00:00.000Z\\",\\"dateModified\\":\\"2022-04-27T14:01:51.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zhao Bin\\",\\"url\\":\\"zhaobc.site\\",\\"email\\":\\"hi@zhaobc.site\\"}]}"]],"description":"更新 OpenMediaVault 很久之前折腾过的 N1 盒子，一直默默运行着，用处不大所以一直没再折腾，最近孩子听课，在家看孩子，想看电视时，拔掉 USB 运行原来的盒子系统，用来做电视盒子。 摸了几次 N1 盒子后才想着是不是该升级一下了，于是又开始了折腾。。 简介 之前折腾 newifi-d3 时逛恩山论坛，看到有人折腾 N1 盒子，看着能运行..."},"headers":[{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[]},{"level":2,"title":"遇到的问题和解决办法","slug":"遇到的问题和解决办法","link":"#遇到的问题和解决办法","children":[{"level":3,"title":"omv 源","slug":"omv-源","link":"#omv-源","children":[]},{"level":3,"title":"Wifi 网络不可用","slug":"wifi-网络不可用","link":"#wifi-网络不可用","children":[]},{"level":3,"title":"升级 PHP","slug":"升级-php","link":"#升级-php","children":[]},{"level":3,"title":"切换 PHP 版本","slug":"切换-php-版本","link":"#切换-php-版本","children":[]}]},{"level":2,"title":"升级 NextCloud","slug":"升级-nextcloud","link":"#升级-nextcloud","children":[{"level":3,"title":"command line","slug":"command-line","link":"#command-line","children":[]},{"level":3,"title":"Installer","slug":"installer","link":"#installer","children":[]}]}],"git":{"createdTime":1650884989000,"updatedTime":1651068111000,"contributors":[{"name":"Zhao Bin","email":"413853119@qq.com","commits":2}]},"readingTime":{"minutes":4.47,"words":1342},"filePathRelative":"posts/n1/upgrade-omv.md","localizedDate":"2022年4月20日","excerpt":"\\n<p>很久之前折腾过的 N1 盒子，一直默默运行着，用处不大所以一直没再折腾，最近孩子听课，在家看孩子，想看电视时，拔掉 USB 运行原来的盒子系统，用来做电视盒子。<br>\\n摸了几次 N1 盒子后才想着是不是该升级一下了，于是又开始了折腾。。</p>\\n<h2>简介</h2>\\n<p>之前折腾 newifi-d3 时逛恩山论坛，看到有人折腾 N1 盒子，看着能运行 linux 系统，还能做 NAS 所以从 PDD 上买了一个，同时也从海鲜市场上买了一个移动硬盘，被骗了一个相当老的影片，运行时间长，速度还慢。。</p>\\n<p>经过折腾，安装了 armbian, docker, nextcloud，理论上可做下载机，小型 NAS，但是没怎么用，偶尔用来做 win 和 macOS 的中转站。<br>\\n安装 armbian 的过程已经不记得了，网上可搜到很多。</p>","autoDesc":true}');export{c as comp,u as data};
